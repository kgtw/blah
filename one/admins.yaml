kind: role
version: v4
metadata:
  name: admins
spec:
  # SSH options used for user sessions with default values:
  options:
    # max_session_ttl defines the TTL (time to live) of SSH certificates
    # issued to the users with this role.
    max_session_ttl: 8h
    # forward_agent controls whether SSH agent forwarding is allowed
    forward_agent: true

  # The allow section declares a list of resource/verb combinations that are
  # allowed for the users of this role. By default, nothing is allowed.
  allow:
    # The logins array defines the OS/UNIX logins a user is allowed to use.
    # a few special variables are supported here (see below)
    logins: [root, '{{internal.logins}}']
    # If kubernetes integration is enabled, this setting configures which 
    # kubernetes groups the users of this role will be assigned to.
    # Note that you can refer to a SAML/OIDC trait via the "external" property bag.
    # This allows you to specify Kubernetes group membership in an identity manager:
    kubernetes_groups: ["system:masters", "{{external.trait_name}}"]]

    # List of node labels a user will be allowed to connect to:
    node_labels:
      # A user can only connect to a node marked with 'test' label:
      'environment': 'test'

    kubernetes_labels:
      # A user can only access prod enviroments
      'env': 'prod'

    # Defines roles that this user can request.
    # Needed for teleport's access request workflow
    # https://goteleport.com/teleport/docs/enterprise/workflow/
    request:
      roles:
      - dba

    # List of allow-rules. See below for more information.
    rules:
    - resources: [role]
      verbs: [list, create, read, update, delete]

  # The deny section uses the identical format as the 'allow' section.
  # The deny rules always override allow rules.
  deny: {}
